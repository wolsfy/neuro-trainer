<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ë–∏—Ç–≤–∞ –ü–æ–ª—É—à–∞—Ä–∏–π</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/robot-animations.css">
    <style>
        .screen { justify-content: flex-start; padding-top: 20px; }
        .word-container { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; }
        .stroop-word { font-size: 3.5rem; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; transition: transform 0.1s; }
        .instruction { margin-top: 15px; color: #777; font-size: 1rem; text-align: center; }
        .combo-box { font-size: 1.2rem; font-weight: bold; color: var(--accent); height: 30px; opacity: 0; transition: opacity 0.2s; }
        .combo-box.visible { opacity: 1; }
        .buttons-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 90%; max-width: 350px; margin-bottom: 40px; }
        .color-btn { border: none; padding: 25px 10px; border-radius: 16px; font-size: 1.1rem; font-weight: bold; color: white; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: transform 0.1s, filter 0.1s; text-transform: uppercase; }
        .color-btn:active { transform: scale(0.96); filter: brightness(0.9); }
        .shake-screen { animation: shake 0.4s; }
        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-10px);} 75% {transform: translateX(10px);} }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="../js/achievements.js"></script>
    <script src="../js/game-stats.js"></script>
    <script src="../js/game-robot.js"></script>
</head>
<body>
    <div class="top-bar"><a href="../index.html" class="btn-back">‚Üê</a><div><div class="game-info" id="score">0</div><div class="game-info" id="timer" style="font-size: 1rem; color: #777; text-align: right;">60s</div></div></div>
    <div class="screen" id="game-screen"><div class="combo-box" id="combo">COMBO x2!</div><div class="word-container"><div class="stroop-word" id="word">–°–õ–û–í–û</div><div class="instruction">–ñ–º–∏ –Ω–∞ <b style="color:black">–¶–í–ï–¢</b> –±—É–∫–≤!</div></div><div class="buttons-grid" id="buttons-area"></div></div>
    <script>
        const COLORS = [{name: '–ö–†–ê–°–ù–´–ô', hex: '#FF5252'}, {name: '–°–ò–ù–ò–ô', hex: '#2196F3'}, {name: '–ó–ï–õ–ï–ù–´–ô', hex: '#4CAF50'}, {name: '–ñ–ï–õ–¢–´–ô', hex: '#FFC107'}];
        const GAME_TIME = 60;
        let score = 0, timeLeft = GAME_TIME, combo = 1, maxCombo = 1, isPlaying = false, correctColorHex = '', timerInterval;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) { if (audioCtx.state === 'suspended') audioCtx.resume(); const osc = audioCtx.createOscillator(), gain = audioCtx.createGain(); osc.connect(gain); gain.connect(audioCtx.destination); if (type === 'good') { osc.frequency.setValueAtTime(600 + (combo * 100), audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1); osc.start(); osc.stop(audioCtx.currentTime + 0.1); } else { osc.type = 'sawtooth'; osc.frequency.setValueAtTime(100, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3); osc.start(); osc.stop(audioCtx.currentTime + 0.3); } }
        
        function initGame() { score = 0; timeLeft = GAME_TIME; combo = 1; maxCombo = 1; isPlaying = true; updateScoreUI(); const area = document.getElementById('buttons-area'); area.innerHTML = ''; COLORS.forEach(c => { let btn = document.createElement('button'); btn.className = 'color-btn'; btn.style.backgroundColor = c.hex; btn.innerText = c.name; btn.onclick = () => handleInput(c.hex); area.appendChild(btn); }); clearInterval(timerInterval); timerInterval = setInterval(() => { timeLeft--; document.getElementById('timer').innerText = timeLeft + 's'; if (timeLeft <= 0) endGame(); }, 1000); setTimeout(() => { if (window.gameRobot && window.gameRobot.initialized) window.gameRobot.onGameStart(); nextTurn(); }, 100); }
        
        function nextTurn() { let wordObj = COLORS[Math.floor(Math.random() * COLORS.length)], colorObj = COLORS[Math.floor(Math.random() * COLORS.length)]; correctColorHex = colorObj.hex; const wordEl = document.getElementById('word'); wordEl.innerText = wordObj.name; wordEl.style.color = correctColorHex; wordEl.style.transform = 'scale(0.8)'; setTimeout(() => wordEl.style.transform = 'scale(1)', 50); }
        
        function handleInput(hex) { if (!isPlaying) return; if (hex === correctColorHex) { playSound('good'); let points = 1 * combo; score += points; if (combo < 5) combo++; if (combo > maxCombo) maxCombo = combo; showComboUI(); if (window.gameRobot && window.gameRobot.initialized) { if (combo >= 5) window.gameRobot.onCombo(combo); else if (Math.random() < 0.2) window.gameRobot.onCorrect(); } nextTurn(); } else { playSound('bad'); combo = 1; showComboUI(); if (window.gameRobot && window.gameRobot.initialized && Math.random() < 0.4) window.gameRobot.onWrong(); const screen = document.getElementById('game-screen'); screen.classList.add('shake-screen'); setTimeout(() => screen.classList.remove('shake-screen'), 400); } updateScoreUI(); }
        
        function showComboUI() { const el = document.getElementById('combo'); if (combo > 1) { el.innerText = `COMBO x${combo}!`; el.classList.add('visible'); } else { el.classList.remove('visible'); } }
        function updateScoreUI() { document.getElementById('score').innerText = score; }
        
        function endGame() { isPlaying = false; clearInterval(timerInterval); window.GameStats.addCoins(score); window.GameStats.updateStroop(maxCombo); if (window.gameRobot && window.gameRobot.initialized) window.gameRobot.onGameOver(); confetti(); alert(`–í—Ä–µ–º—è –≤—ã—à–ª–æ!\n–°—á–µ—Ç: ${score}\n–ú–∞–∫—Å. –∫–æ–º–±–æ: ${maxCombo}\n–í—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏ ${score} –º–æ–Ω–µ—Ç! üí∞`); if(confirm("–ï—â–µ —Ä–∞–∑?")) initGame(); else window.location.href = '../index.html'; }
        
        document.body.addEventListener('click', () => { if (audioCtx.state === 'suspended') audioCtx.resume(); }, { once: true });
        document.addEventListener('dblclick', (e) => e.preventDefault(), { passive: false });
        initGame();
    </script>
</body>
</html>
