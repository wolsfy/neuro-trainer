<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–∞—Ç—Ä–∏—Ü–∞ –ü–∞–º—è—Ç–∏</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/robot-animations.css">
    <style>.memory-grid{display:grid;gap:10px;width:85vw;max-width:350px;aspect-ratio:1;transition:all 0.3s ease;margin-top:20px}.cell{background:#cfd8dc;border-radius:12px;cursor:pointer;transition:transform 0.1s,background-color 0.2s;box-shadow:0 4px 0 #b0bec5}.cell:active{transform:scale(0.95)}.cell.active{background:var(--primary)!important;box-shadow:0 4px 0 #1976D2;transform:scale(1.05)}.cell.correct{background:var(--success)!important;box-shadow:0 4px 0 #388E3C;animation:pop 0.2s}.cell.wrong{background:var(--error)!important;box-shadow:0 4px 0 #D32F2F;animation:shake 0.4s}.level-badge{background:var(--accent);color:white;padding:8px 20px;border-radius:20px;font-size:1.2rem;font-weight:bold;box-shadow:0 4px 10px rgba(255,152,0,0.3);margin-bottom:20px}.status-text{height:20px;color:#777;font-size:0.9rem;margin-top:10px}</style>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="../js/achievements.js"></script>
    <script src="../js/game-stats.js"></script>
    <script src="../js/game-robot.js"></script>
    <script src="../js/level-system.js"></script>
</head>
<body>
    <div class="top-bar"><a href="../index.html" class="btn-back">‚Üê</a><div><div class="game-info" id="score-display">‚òÖ 0</div></div></div>
    <div class="screen"><div class="level-badge" id="level-display">–£—Ä–æ–≤–µ–Ω—å 1</div><div id="grid" class="memory-grid"></div><div class="status-text" id="status">–ó–∞–ø–æ–º–∏–Ω–∞–π...</div></div>
    <script>
        let currentLevel=1,gridSize=3,pattern=[],userClicksCount=0,isInputLocked=true;const gridElement=document.getElementById('grid'),statusElement=document.getElementById('status'),audioCtx=new(window.AudioContext||window.webkitAudioContext)();
        function playSound(t){if(audioCtx.state==='suspended')audioCtx.resume();const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);if(t==='show'){o.type='sine';o.frequency.setValueAtTime(400,audioCtx.currentTime);g.gain.setValueAtTime(0.1,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.1);o.start();o.stop(audioCtx.currentTime+0.1)}else if(t==='correct'){o.frequency.setValueAtTime(600,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.15);o.start();o.stop(audioCtx.currentTime+0.15)}else if(t==='wrong'){o.type='sawtooth';o.frequency.setValueAtTime(100,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.3);o.start();o.stop(audioCtx.currentTime+0.3)}}
        function initGame(){currentLevel=1;gridSize=3;document.getElementById('score-display').innerText=`‚òÖ 0`;setTimeout(()=>startLevel(),100)}
        function startLevel(){isInputLocked=true;userClicksCount=0;pattern=[];document.getElementById('level-display').innerText=`–£—Ä–æ–≤–µ–Ω—å ${currentLevel}`;document.getElementById('score-display').innerText=`‚òÖ ${currentLevel-1}`;statusElement.innerText="–°–º–æ—Ç—Ä–∏ –∏ –∑–∞–ø–æ–º–∏–Ω–∞–π!";if(window.gameRobot&&window.gameRobot.initialized&&currentLevel%3===1)window.gameRobot.onLevelUp();let tilesToShow=3+Math.floor((currentLevel-1)/2);if(currentLevel>=4)gridSize=4;if(currentLevel>=9)gridSize=5;renderGrid();const totalCells=gridSize*gridSize;let indices=Array.from({length:totalCells},(_,i)=>i);indices.sort(()=>Math.random()-0.5);pattern=indices.slice(0,tilesToShow);setTimeout(()=>showPattern(),800)}
        function renderGrid(){gridElement.innerHTML='';gridElement.style.gridTemplateColumns=`repeat(${gridSize}, 1fr)`;const totalCells=gridSize*gridSize;for(let i=0;i<totalCells;i++){let cell=document.createElement('div');cell.className='cell';cell.dataset.id=i;cell.onclick=()=>handleCellClick(cell,i);gridElement.appendChild(cell)}}
        function showPattern(){pattern.forEach((index)=>{gridElement.children[index].classList.add('active')});playSound('show');let showTime=1000+(currentLevel*50);setTimeout(()=>{Array.from(gridElement.children).forEach(c=>c.classList.remove('active'));isInputLocked=false;statusElement.innerText="–ü–æ–≤—Ç–æ—Ä–∏!"},showTime)}
        function handleCellClick(cell,index){if(isInputLocked||cell.classList.contains('correct'))return;if(pattern.includes(index)){playSound('correct');cell.classList.add('correct');userClicksCount++;if(window.gameRobot&&window.gameRobot.initialized&&Math.random()<0.3)window.gameRobot.onCorrect();if(window.levelSystem){const r=window.levelSystem.addXP(window.XP_REWARDS.memoryLevel);if(Math.random()<0.3)window.showXPNotification(window.XP_REWARDS.memoryLevel);if(r.leveledUp)setTimeout(()=>window.showLevelUpNotification(r.oldLevel,r.newLevel),800)}if(userClicksCount===pattern.length){isInputLocked=true;statusElement.innerText="–û—Ç–ª–∏—á–Ω–æ!";confetti({particleCount:30,spread:50,origin:{y:0.7}});setTimeout(()=>{currentLevel++;startLevel()},1000)}}else{playSound('wrong');cell.classList.add('wrong');isInputLocked=true;statusElement.innerText="–û—à–∏–±–∫–∞!";if(navigator.vibrate)navigator.vibrate(200);if(window.gameRobot&&window.gameRobot.initialized)window.gameRobot.encourage();setTimeout(()=>{let reward=(currentLevel-1)*5;if(reward>0){window.GameStats.addCoins(reward);window.GameStats.updateMemory(currentLevel-1)}alert(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!\n–í—ã –¥–æ—à–ª–∏ –¥–æ —É—Ä–æ–≤–Ω—è ${currentLevel}\n–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: ${reward} –º–æ–Ω–µ—Ç üí∞`);initGame()},500)}}
        document.body.addEventListener('click',()=>{if(audioCtx.state==='suspended')audioCtx.resume()},{once:true});document.addEventListener('dblclick',(e)=>e.preventDefault(),{passive:false});initGame();
    </script>
</body>
</html>
