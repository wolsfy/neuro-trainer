<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2048</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/robot-animations.css">
    <style>
        .game-2048{width:90vw;max-width:400px;background:#bbada0;border-radius:12px;padding:10px;margin:20px auto;position:relative}.grid-container{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;background:#cdc1b4;border-radius:8px;padding:10px}.cell{aspect-ratio:1;background:#eee4da;border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:2rem;color:#776e65;position:relative;transition:all 0.15s}.cell.tile-2{background:#eee4da;color:#776e65}.cell.tile-4{background:#ede0c8;color:#776e65}.cell.tile-8{background:#f2b179;color:#f9f6f2}.cell.tile-16{background:#f59563;color:#f9f6f2}.cell.tile-32{background:#f67c5f;color:#f9f6f2}.cell.tile-64{background:#f65e3b;color:#f9f6f2}.cell.tile-128{background:#edcf72;color:#f9f6f2;font-size:1.7rem}.cell.tile-256{background:#edcc61;color:#f9f6f2;font-size:1.7rem}.cell.tile-512{background:#edc850;color:#f9f6f2;font-size:1.7rem}.cell.tile-1024{background:#edc53f;color:#f9f6f2;font-size:1.4rem}.cell.tile-2048{background:#edc22e;color:#f9f6f2;font-size:1.4rem;box-shadow:0 0 30px 10px rgba(243,215,116,0.55)}.cell.tile-new{animation:appear 0.2s}.cell.tile-merged{animation:pop 0.2s}@keyframes appear{0%{transform:scale(0)}100%{transform:scale(1)}}@keyframes pop{0%{transform:scale(1)}50%{transform:scale(1.2)}100%{transform:scale(1)}}.game-over-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(238,228,218,0.73);border-radius:8px;display:none;align-items:center;justify-content:center;z-index:100}.game-over-overlay.show{display:flex}.game-over-msg{text-align:center}.game-over-text{font-size:2rem;font-weight:bold;color:#776e65;margin-bottom:20px}.restart-btn{background:#8f7a66;color:#f9f6f2;border:none;padding:15px 30px;border-radius:8px;font-size:1.1rem;font-weight:bold;cursor:pointer}.restart-btn:active{background:#9f8a76}.score-panel{display:flex;gap:10px;justify-content:space-between;margin-bottom:15px}.score-box{background:#bbada0;padding:10px 15px;border-radius:8px;text-align:center;flex:1}.score-label{font-size:0.8rem;color:#eee4da;text-transform:uppercase}.score-value{font-size:1.5rem;font-weight:900;color:#fff}.controls-hint{text-align:center;color:#776e65;font-size:0.9rem;margin-top:10px;padding:10px}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="../js/achievements.js"></script>
    <script src="../js/game-robot.js"></script>
    <script src="../js/level-system.js"></script>
    <script src="../js/energy-system.js"></script>
    <script src="../js/daily-quests.js"></script>
    <script src="../js/quest-tracker.js"></script>
</head>
<body>
    <div class="top-bar"><a href="../index.html" class="btn-back">‚Üê</a><div><div class="game-info" id="moves">0 —Ö–æ–¥–æ–≤</div></div></div>
    <div class="screen">
        <div class="score-panel"><div class="score-box"><div class="score-label">–°—á–µ—Ç</div><div class="score-value" id="score">0</div></div><div class="score-box"><div class="score-label">–õ—É—á—à–∏–π</div><div class="score-value" id="best">0</div></div></div>
        <div class="game-2048">
            <div class="grid-container" id="grid"></div>
            <div class="game-over-overlay" id="gameOver"><div class="game-over-msg"><div class="game-over-text">–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</div><button class="restart-btn" onclick="resetGame()">–ï—â–µ —Ä–∞–∑</button></div></div>
        </div>
        <div class="controls-hint">üëÜ –ü—Ä–æ–≤–æ–¥–∏—Ç–µ –ø–∞–ª—å—Ü–µ–º –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏</div>
    </div>
    <script>
let grid=[],score=0,moves=0,bestScore=0,hasWon=false,touchStartX=0,touchStartY=0;const gridSize=4,gridElement=document.getElementById('grid');
function init(){if(window.QuestTracker){const cost=15;window.QuestTracker.energySpent(cost)}bestScore=parseInt(localStorage.getItem('neuro2048Best'))||0;document.getElementById('best').textContent=bestScore;if(window.gameRobot&&window.gameRobot.initialized)window.gameRobot.onGameStart();resetGame()}
function resetGame(){grid=Array(gridSize).fill().map(()=>Array(gridSize).fill(0));score=0;moves=0;hasWon=false;updateDisplay();addRandomTile();addRandomTile();document.getElementById('gameOver').classList.remove('show')}
function addRandomTile(){const empty=[];for(let r=0;r<gridSize;r++){for(let c=0;c<gridSize;c++){if(grid[r][c]===0)empty.push({r,c})}}if(empty.length>0){const{r,c}=empty[Math.floor(Math.random()*empty.length)];grid[r][c]=Math.random()<0.9?2:4}}
function updateDisplay(){gridElement.innerHTML='';for(let r=0;r<gridSize;r++){for(let c=0;c<gridSize;c++){const cell=document.createElement('div');cell.className='cell';if(grid[r][c]>0){cell.classList.add(`tile-${grid[r][c]}`);cell.textContent=grid[r][c]}gridElement.appendChild(cell)}}document.getElementById('score').textContent=score;document.getElementById('moves').textContent=moves+' —Ö–æ–¥–æ–≤'}
function move(direction){let moved=false,newGrid=grid.map(row=>[...row]);if(direction==='left'){for(let r=0;r<gridSize;r++){let row=grid[r].filter(v=>v);for(let i=0;i<row.length-1;i++){if(row[i]===row[i+1]){row[i]*=2;score+=row[i];row.splice(i+1,1)}}while(row.length<gridSize)row.push(0);newGrid[r]=row}}else if(direction==='right'){for(let r=0;r<gridSize;r++){let row=grid[r].filter(v=>v);for(let i=row.length-1;i>0;i--){if(row[i]===row[i-1]){row[i]*=2;score+=row[i];row.splice(i-1,1)}}while(row.length<gridSize)row.unshift(0);newGrid[r]=row}}else if(direction==='up'){for(let c=0;c<gridSize;c++){let col=[];for(let r=0;r<gridSize;r++)if(grid[r][c])col.push(grid[r][c]);for(let i=0;i<col.length-1;i++){if(col[i]===col[i+1]){col[i]*=2;score+=col[i];col.splice(i+1,1)}}while(col.length<gridSize)col.push(0);for(let r=0;r<gridSize;r++)newGrid[r][c]=col[r]}}else if(direction==='down'){for(let c=0;c<gridSize;c++){let col=[];for(let r=0;r<gridSize;r++)if(grid[r][c])col.push(grid[r][c]);for(let i=col.length-1;i>0;i--){if(col[i]===col[i-1]){col[i]*=2;score+=col[i];col.splice(i-1,1)}}while(col.length<gridSize)col.unshift(0);for(let r=0;r<gridSize;r++)newGrid[r][c]=col[r]}}for(let r=0;r<gridSize;r++){for(let c=0;c<gridSize;c++){if(grid[r][c]!==newGrid[r][c]){moved=true;break}}}if(moved){grid=newGrid;moves++;addRandomTile();updateDisplay();if(window.levelSystem){const xp=5;window.levelSystem.addXP(xp)}if(score>bestScore){bestScore=score;localStorage.setItem('neuro2048Best',bestScore);document.getElementById('best').textContent=bestScore}checkWin();checkGameOver()}}
function checkWin(){if(hasWon)return;for(let r=0;r<gridSize;r++){for(let c=0;c<gridSize;c++){if(grid[r][c]===2048){hasWon=true;if(window.QuestTracker)window.QuestTracker.newRecord();confetti();setTimeout(()=>alert('üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ 2048!'),300);return}}}}
function checkGameOver(){for(let r=0;r<gridSize;r++){for(let c=0;c<gridSize;c++){if(grid[r][c]===0)return;if(c<gridSize-1&&grid[r][c]===grid[r][c+1])return;if(r<gridSize-1&&grid[r][c]===grid[r+1][c])return}}endGame()}
function endGame(){document.getElementById('gameOver').classList.add('show');const coins=Math.floor(score/100);if(coins>0){let currentCoins=parseInt(localStorage.getItem('neuroCoins'))||0;localStorage.setItem('neuroCoins',currentCoins+coins)}if(window.QuestTracker)window.QuestTracker.gameCompleted();if(window.gameRobot&&window.gameRobot.initialized)window.gameRobot.onGameOver();setTimeout(()=>alert(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!\n–°—á–µ—Ç: ${score}\n–•–æ–¥–æ–≤: ${moves}\n–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: ${coins} üí∞`),500)}
document.addEventListener('keydown',e=>{if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key)){e.preventDefault();const dir={ArrowLeft:'left',ArrowRight:'right',ArrowUp:'up',ArrowDown:'down'}[e.key];move(dir)}});
document.addEventListener('touchstart',e=>{touchStartX=e.touches[0].clientX;touchStartY=e.touches[0].clientY},{passive:true});
document.addEventListener('touchend',e=>{if(!touchStartX||!touchStartY)return;const touchEndX=e.changedTouches[0].clientX,touchEndY=e.changedTouches[0].clientY,dx=touchEndX-touchStartX,dy=touchEndY-touchStartY;if(Math.abs(dx)<30&&Math.abs(dy)<30)return;if(Math.abs(dx)>Math.abs(dy)){move(dx>0?'right':'left')}else{move(dy>0?'down':'up')}touchStartX=0;touchStartY=0},{passive:true});
init();
    </script>
</body>
</html>
