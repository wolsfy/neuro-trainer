<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –î–æ–∂–¥—å</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/robot-animations.css">
    <style>.top-bar{background:rgba(255,255,255,0.98);backdrop-filter:blur(10px);box-shadow:0 3px 15px rgba(0,0,0,0.15);padding:15px;border-radius:0 0 20px 20px;display:flex;justify-content:space-between;align-items:center;z-index:100}.score-container{display:flex;gap:20px;align-items:center}.score-box{background:linear-gradient(135deg,#2196F3,#1976D2);color:white;padding:8px 16px;border-radius:12px;font-weight:900;font-size:1.4rem;box-shadow:0 3px 8px rgba(33,150,243,0.3);min-width:60px;text-align:center}.coins-box{background:linear-gradient(135deg,#FFC107,#FF9800);color:white;padding:8px 16px;border-radius:12px;font-weight:900;font-size:1.2rem;box-shadow:0 3px 8px rgba(255,193,7,0.3);display:flex;align-items:center;gap:5px}.game-area{position:relative;width:95%;height:58vh;border-bottom:3px solid var(--primary);overflow:hidden;background:linear-gradient(to bottom,#eef2f5,#e3f2fd);border-radius:12px;margin-bottom:15px;touch-action:none}.falling-item{position:absolute;top:-60px;background:white;padding:10px 18px;border-radius:12px;font-weight:900;font-size:1.6rem;color:var(--text);box-shadow:0 4px 10px rgba(0,0,0,0.15);border:2px solid #fff;z-index:10}.controls-math{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;width:95%;max-width:400px;margin-bottom:12px}.btn-math{background:white;border:none;padding:20px 0;font-size:1.8rem;border-radius:16px;box-shadow:0 4px 0 #dce0e6;cursor:pointer;color:var(--primary);font-weight:bold;transition:transform 0.1s}.btn-math:active{transform:translateY(4px);box-shadow:none;background:#f5f5f5}.coin-popup{position:absolute;color:#FFC107;font-weight:900;font-size:1.8rem;animation:floatUp 0.8s forwards;pointer-events:none;text-shadow:0 2px 4px rgba(0,0,0,0.2);z-index:20}@keyframes floatUp{0%{transform:translateY(0) scale(1);opacity:1}100%{transform:translateY(-80px) scale(1.2);opacity:0}}.lives-display{font-size:1.3rem;font-weight:bold;color:var(--text);padding-bottom:20px}</style>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="../js/achievements.js"></script>
    <script src="../js/game-stats.js"></script>
    <script src="../js/game-robot.js"></script>
</head>
<body>
    <div class="top-bar"><a href="../index.html" class="btn-back">‚Üê</a><div class="score-container"><div class="score-box" id="score">0</div><div class="coins-box"><span id="earned-coins">0</span><span>üí∞</span></div></div></div>
    <div class="screen" style="justify-content:flex-start;padding-top:85px;padding-bottom:10px"><div class="game-area" id="game-area"></div><div class="controls-math"><button class="btn-math" onclick="checkAnswer(1)">1</button><button class="btn-math" onclick="checkAnswer(2)">2</button><button class="btn-math" onclick="checkAnswer(3)">3</button><button class="btn-math" onclick="checkAnswer(4)">4</button><button class="btn-math" onclick="checkAnswer(5)">5</button><button class="btn-math" onclick="checkAnswer(6)">6</button><button class="btn-math" onclick="checkAnswer(7)">7</button><button class="btn-math" onclick="checkAnswer(8)">8</button><button class="btn-math" onclick="checkAnswer(9)">9</button></div><div class="lives-display">–ñ–∏–∑–Ω–∏: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div></div>
    <script>
        const audioCtx=new(window.AudioContext||window.webkitAudioContext)();function playSound(t){if(audioCtx.state==='suspended')audioCtx.resume();const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);if(t==='pop'){o.type='sine';o.frequency.setValueAtTime(600,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.1);o.start();o.stop(audioCtx.currentTime+0.1)}else if(t==='crash'){o.type='sawtooth';o.frequency.setValueAtTime(100,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.3);o.start();o.stop(audioCtx.currentTime+0.3)}}
        let score=0,lives=3,perfectStreak=0,maxPerfectStreak=0,animationFrameId,spawnIntervalId,items=[],isPlaying=false;const area=document.getElementById('game-area');
        function initGame(){score=0;lives=3;perfectStreak=0;maxPerfectStreak=0;items=[];area.innerHTML='';isPlaying=true;document.getElementById('score').innerText=score;document.getElementById('lives').innerText='‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è';document.getElementById('earned-coins').innerText=0;setTimeout(()=>{if(window.gameRobot&&window.gameRobot.initialized)window.gameRobot.onGameStart();animationFrameId=requestAnimationFrame(gameLoop);spawnIntervalId=setInterval(spawnItem,2000)},100)}
        function spawnItem(){if(!isPlaying)return;let r=Math.floor(Math.random()*9)+1,a=Math.floor(Math.random()*r),b=r-a,t=`${a} + ${b}`,el=document.createElement('div');el.className='falling-item';el.innerText=t;el.style.left=Math.random()*(area.clientWidth-90)+'px';area.appendChild(el);let s=1.5+(Math.floor(score/10)*0.4);items.push({el:el,y:-60,val:r,speed:s})}
        function gameLoop(){if(!isPlaying)return;animationFrameId=requestAnimationFrame(gameLoop);for(let i=items.length-1;i>=0;i--){let item=items[i];item.y+=item.speed;item.el.style.top=item.y+'px';if(item.y>area.clientHeight-50){loseLife();perfectStreak=0;item.el.remove();items.splice(i,1)}}}
        function checkAnswer(v){if(!isPlaying)return;let c=[];items.forEach((item,idx)=>{if(item.val===v)c.push({index:idx,y:item.y})});if(c.length>0){c.sort((a,b)=>b.y-a.y);let t=c[0],item=items[t.index];playSound('pop');showCoinAnim(item.el.style.left,item.el.style.top);item.el.remove();items.splice(t.index,1);score++;perfectStreak++;if(perfectStreak>maxPerfectStreak)maxPerfectStreak=perfectStreak;document.getElementById('score').innerText=score;document.getElementById('earned-coins').innerText=score;if(window.gameRobot&&window.gameRobot.initialized){if(perfectStreak%10===0)window.gameRobot.onCombo(perfectStreak);else if(Math.random()<0.2)window.gameRobot.onCorrect()}}else{perfectStreak=0;if(navigator.vibrate)navigator.vibrate(50);const ga=document.getElementById('game-area');ga.style.borderBottom="3px solid #FF5252";setTimeout(()=>ga.style.borderBottom="3px solid var(--primary)",200);if(window.gameRobot&&window.gameRobot.initialized&&Math.random()<0.4)window.gameRobot.onWrong()}}
        function loseLife(){playSound('crash');lives--;let h='';for(let i=0;i<lives;i++)h+='‚ù§Ô∏è';document.getElementById('lives').innerText=h;area.style.background='#ffebee';setTimeout(()=>area.style.background='',200);if(window.gameRobot&&window.gameRobot.initialized)window.gameRobot.encourage();if(lives<=0)gameOver()}
        function showCoinAnim(x,y){let el=document.createElement('div');el.className='coin-popup';el.innerText='+1 üí∞';el.style.left=x;el.style.top=y;area.appendChild(el);setTimeout(()=>el.remove(),1000)}
        function gameOver(){isPlaying=false;cancelAnimationFrame(animationFrameId);clearInterval(spawnIntervalId);window.GameStats.addCoins(score);window.GameStats.updateMath(maxPerfectStreak);if(window.gameRobot&&window.gameRobot.initialized)window.gameRobot.onGameOver();confetti();alert(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!\n–í—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏: ${score} –º–æ–Ω–µ—Ç\n–ú–∞–∫—Å. —Å–µ—Ä–∏—è: ${maxPerfectStreak}`);window.location.href='../index.html'}
        document.body.addEventListener('click',()=>{if(audioCtx.state==='suspended')audioCtx.resume()},{once:true});
        setTimeout(initGame,100);
    </script>
</body>
</html>
