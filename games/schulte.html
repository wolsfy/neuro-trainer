<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢–∞–±–ª–∏—Ü–∞ –®—É–ª—å—Ç–µ</title>
    <link rel="stylesheet" href="../css/style.css">
    
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–º—ã -->
    <script src="/neuro-trainer/js/theme-loader.js?v=2"></script>
    
    <link rel="stylesheet" href="../css/mobile.css?v=5">
    <link rel="stylesheet" href="../css/robot-animations.css">
    <style>
/* –ú–û–ë–ò–õ–¨–ù–´–ï –°–¢–ò–õ–ò - –ü–†–Ø–ú–û –í HTML */
@media (max-width: 768px) {
    body { overflow-y: auto !important; height: auto !important; }
    .screen { padding-top: 100px !important; padding-bottom: 100px !important; overflow-y: auto !important; }
    #game-robot, .robot-container, div[id*="robot"], div[class*="robot"] {
        display: none !important;
        opacity: 0 !important;
        visibility: hidden !important;
        pointer-events: none !important;
        position: absolute !important;
        left: -9999px !important;
        width: 0 !important;
        height: 0 !important;
    }
    .top-bar { position: fixed !important; top: 0 !important; z-index: 1001 !important; }
}
/* –¢–ï–ö–°–¢–û–í–´–ï –ü–û–î–°–ö–ê–ó–ö–ò */
.mobile-hint {
    position: fixed;
    top: 60px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 12px 24px;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: bold;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 1000;
    animation: hintSlideIn 0.3s ease-out;
    max-width: 80%;
    text-align: center;
}
@keyframes hintSlideIn {
    from { top: 40px; opacity: 0; }
    to { top: 60px; opacity: 1; }
}
.mobile-hint.success { background: linear-gradient(135deg, #4CAF50, #45a049); }
.mobile-hint.combo { background: linear-gradient(135deg, #FF9800, #F57C00); }
.mobile-hint.error { background: linear-gradient(135deg, #F44336, #D32F2F); }
.mobile-hint.record { background: linear-gradient(135deg, #FFD700, #FFA500); }
.schulte-grid{display:grid;gap:10px;width:92vw;max-width:400px;aspect-ratio:1;margin-top:20px}.schulte-grid.size-3{grid-template-columns:repeat(3,1fr)}.schulte-grid.size-5{grid-template-columns:repeat(5,1fr)}.cell{background:var(--card-bg);border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:bold;color:var(--text);box-shadow:0 4px 0 #dce0e6;cursor:pointer;user-select:none;transition:transform 0.1s}.cell:active{transform:translateY(4px);box-shadow:none}.target-display{font-size:1.2rem;color:var(--text);opacity:0.7;margin-bottom:10px;text-align:center}.target-number{font-size:2.5rem;color:var(--primary);font-weight:bold;margin-left:10px}.controls{display:flex;gap:15px;margin-top:30px}.btn-mode{border:none;padding:12px 24px;border-radius:10px;background:#E0E0E0;color:#555;font-weight:bold;font-size:1rem;cursor:pointer}.btn-mode.active{background:var(--primary);color:white;box-shadow:0 4px 10px rgba(33,150,243,0.3)}.btn-restart{background:var(--accent);color:white}.best-score{font-size:0.9rem;color:var(--accent);font-weight:bold;text-align:right}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="../js/achievements.js"></script>
    <script src="../js/game-robot.js"></script>
    <script src="../js/level-system.js"></script>
</head>
<body>
    <div class="top-bar"><a href="../index.html" class="btn-back">‚Üê</a><div><div class="game-info" id="timer">00.00</div><div class="best-score" id="best-score">üèÜ --:--</div></div></div>
    <div class="screen"><div class="target-display">–ò—â–∏ —á–∏—Å–ª–æ: <span id="target-num" class="target-number">1</span></div><div id="grid" class="schulte-grid size-5"></div><div class="controls"><button class="btn-mode" id="mode-3" onclick="setMode(3)">3x3</button><button class="btn-mode active" id="mode-5" onclick="setMode(5)">5x5</button><button class="btn-mode btn-restart" onclick="restartGame()">‚Üª</button></div></div>
    <script>
        const isMobile = window.innerWidth <= 768;
        
        // –¢–ï–ö–°–¢–û–í–´–ï –ü–û–î–°–ö–ê–ó–ö–ò –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–•
        function showMobileHint(text, type = 'default') {
            if (!isMobile) return;
            
            const existing = document.querySelector('.mobile-hint');
            if (existing) existing.remove();
            
            const hint = document.createElement('div');
            hint.className = `mobile-hint ${type}`;
            hint.textContent = text;
            document.body.appendChild(hint);
            
            setTimeout(() => {
                hint.style.opacity = '0';
                hint.style.top = '40px';
                hint.style.transition = 'all 0.3s';
                setTimeout(() => hint.remove(), 300);
            }, 2000);
        }
        
        // –£–ë–ò–†–ê–ï–ú –†–û–ë–û–¢–ê –ù–ê –ú–û–ë–ò–õ–¨–ù–´–•
        if(isMobile) {
            window.gameRobot = null;
            document.addEventListener('DOMContentLoaded', function() {
                const robotElements = document.querySelectorAll('#game-robot, .robot-container, [id*="robot"], [class*="robot"]');
                robotElements.forEach(el => {
                    if(el) el.remove();
                });
            });
            setInterval(() => {
                const robots = document.querySelectorAll('#game-robot, .robot-container, [id*="robot"], [class*="robot"]');
                robots.forEach(el => {
                    if(el && el.id !== 'game-info' && !el.classList.contains('btn-restart')) el.remove();
                });
            }, 100);
        }
        
        let currentGridSize=5,currentTarget=1,timerInterval,isPlaying=false,correctStreak=0;const gridElement=document.getElementById('grid'),targetElement=document.getElementById('target-num'),timerElement=document.getElementById('timer'),bestScoreElement=document.getElementById('best-score'),audioCtx=new(window.AudioContext||window.webkitAudioContext)();function playSound(t){if(audioCtx.state==='suspended')audioCtx.resume();const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);if(t==='click'){o.type='sine';o.frequency.setValueAtTime(600,audioCtx.currentTime);o.frequency.exponentialRampToValueAtTime(1200,audioCtx.currentTime+0.1);g.gain.setValueAtTime(0.2,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.15);o.start();o.stop(audioCtx.currentTime+0.15)}else if(t==='error'){o.type='sawtooth';o.frequency.setValueAtTime(150,audioCtx.currentTime);o.frequency.linearRampToValueAtTime(100,audioCtx.currentTime+0.2);g.gain.setValueAtTime(0.2,audioCtx.currentTime);g.gain.linearRampToValueAtTime(0.01,audioCtx.currentTime+0.2);o.start();o.stop(audioCtx.currentTime+0.2)}else if(t==='win'){[440,554,659].forEach((freq,i)=>{const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.frequency.value=freq;g.gain.setValueAtTime(0.1,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+1.5);o.start(audioCtx.currentTime+i*0.1);o.stop(audioCtx.currentTime+1.5+i*0.1)})}}function setMode(s){currentGridSize=s;document.querySelectorAll('.btn-mode').forEach(btn=>btn.classList.remove('active'));document.getElementById(`mode-${s}`).classList.add('active');gridElement.className=`schulte-grid size-${s}`;updateBestScoreDisplay();restartGame()}function updateBestScoreDisplay(){const k=`schulte_best_${currentGridSize}`,b=localStorage.getItem(k);bestScoreElement.innerText=b?`üèÜ ${b}—Å`:`üèÜ --:--`}function restartGame(){isPlaying=true;currentTarget=1;correctStreak=0;targetElement.innerText="1";timerElement.innerText="00.00";if(isMobile)showMobileHint('üöÄ –ü–æ–µ—Ö–∞–ª–∏!','success');if(window.gameRobot&&window.gameRobot.initialized)window.gameRobot.onGameStart();clearInterval(timerInterval);let s=Date.now();timerInterval=setInterval(()=>{let d=(Date.now()-s)/1000;timerElement.innerText=d.toFixed(2)},50);renderGrid()}function renderGrid(){gridElement.innerHTML='';const c=currentGridSize*currentGridSize;let n=[];for(let i=1;i<=c;i++)n.push(i);n.sort(()=>Math.random()-0.5);n.forEach(num=>{const cell=document.createElement('div');cell.className='cell';cell.innerText=num;cell.style.fontSize=currentGridSize===3?'3rem':'2rem';cell.onpointerdown=(e)=>{e.preventDefault();handleCellClick(cell,num,c)};gridElement.appendChild(cell)})}function handleCellClick(cell,number,maxNumber){if(!isPlaying)return;if(number===currentTarget){playSound('click');cell.classList.add('correct-anim');correctStreak++;if(isMobile){if(correctStreak%5===0&&correctStreak>0)showMobileHint(`üî• –°–µ—Ä–∏—è x${correctStreak}!`,'combo');else if(Math.random()<0.3){const hints=['üëç –û—Ç–ª–∏—á–Ω–æ!','‚ú® –•–æ—Ä–æ—à–æ!','üéØ –¢–æ—á–Ω–æ!','‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!'];showMobileHint(hints[Math.floor(Math.random()*hints.length)],'success')}}if(window.gameRobot&&window.gameRobot.initialized){if(correctStreak%5===0&&correctStreak>0)window.gameRobot.onCombo(correctStreak);else if(Math.random()<0.3)window.gameRobot.onCorrect()}currentTarget++;if(currentTarget>maxNumber)gameWin();else targetElement.innerText=currentTarget}else{playSound('error');correctStreak=0;cell.style.backgroundColor='#FF5252';cell.style.color='white';if(isMobile&&Math.random()<0.5)showMobileHint('‚ùå –ù–µ —Ç–æ —á–∏—Å–ª–æ','error');if(window.gameRobot&&window.gameRobot.initialized&&Math.random()<0.5)window.gameRobot.onWrong();setTimeout(()=>{cell.style.backgroundColor='';cell.style.color=''},300)}}function gameWin(){isPlaying=false;clearInterval(timerInterval);playSound('win');confetti();const finalTime=parseFloat(timerElement.innerText);let reward=15;saveCoins(reward);const xpAmount=currentGridSize===5?window.XP_REWARDS.schulte5x5:window.XP_REWARDS.schulte3x3;if(window.levelSystem){const result=window.levelSystem.addXP(xpAmount);window.showXPNotification(xpAmount);if(result.leveledUp)setTimeout(()=>window.showLevelUpNotification(result.oldLevel,result.newLevel),1200)}updateGameStats(finalTime);const k=`schulte_best_${currentGridSize}`,oldRecord=parseFloat(localStorage.getItem(k))||9999,isNewRecord=finalTime<oldRecord;if(isNewRecord){localStorage.setItem(k,finalTime);if(isMobile)showMobileHint('üèÜ –ù–û–í–´–ô –†–ï–ö–û–†–î!','record');if(window.gameRobot&&window.gameRobot.initialized)window.gameRobot.onNewRecord();if(window.levelSystem){const r=window.levelSystem.addXP(window.XP_REWARDS.newRecord);setTimeout(()=>window.showXPNotification(window.XP_REWARDS.newRecord),600);if(r.leveledUp)setTimeout(()=>window.showLevelUpNotification(r.oldLevel,r.newLevel),1800)}}else{if(isMobile)showMobileHint('üéâ –ü–æ–±–µ–¥–∞!','success');if(window.gameRobot&&window.gameRobot.initialized)window.gameRobot.onGameOver()}checkRecord(finalTime,reward,isNewRecord)}function updateGameStats(t){let totalGames=parseInt(localStorage.getItem('neuroTotalGames'))||0;localStorage.setItem('neuroTotalGames',totalGames+1);let schultePlayed=parseInt(localStorage.getItem('neuroSchultePlayed'))||0;localStorage.setItem('neuroSchultePlayed',schultePlayed+1);let bestTime=parseFloat(localStorage.getItem('neuroSchulteBestTime'))||9999;if(t<bestTime)localStorage.setItem('neuroSchulteBestTime',t);if(window.AchievementsSystem){const newAchievements=window.AchievementsSystem.check();newAchievements.forEach(ach=>{setTimeout(()=>window.AchievementsSystem.showNotification(ach),1000)})}}function checkRecord(t,r,isNew){updateBestScoreDisplay();setTimeout(()=>{let msg=`–ü–æ–±–µ–¥–∞! –í—Ä–µ–º—è: ${t} —Å\n–í—ã –ø–æ–ª—É—á–∏–ª–∏ ${r} –º–æ–Ω–µ—Ç! üí∞`;if(isNew)msg+=`\nüéâ –ù–û–í–´–ô –†–ï–ö–û–†–î!`;alert(msg)},800)}function saveCoins(a){let currentBank=parseInt(localStorage.getItem('neuroCoins'))||0;localStorage.setItem('neuroCoins',currentBank+a);let totalEarned=parseInt(localStorage.getItem('neuroTotalCoinsEarned'))||0;localStorage.setItem('neuroTotalCoinsEarned',totalEarned+a)}document.body.addEventListener('click',function(){if(audioCtx.state==='suspended')audioCtx.resume()},{once:true});document.addEventListener('dblclick',(e)=>e.preventDefault(),{passive:false});updateBestScoreDisplay();setTimeout(()=>restartGame(),100);
    </script>
</body>
</html>